# Compiler settings
CC = gcc
CFLAGS = -Wall -Wextra -std=c11 -O2
LDFLAGS = -lm -lcriterion

# Directories
SRCDIR = src
TESTDIR = tests
BUILDDIR = build

# Files
SRCS = $(wildcard $(SRCDIR)/*.c)
OBJS = $(SRCS:$(SRCDIR)/%.c=$(BUILDDIR)/%.o)
TESTS = $(wildcard $(TESTDIR)/*.c)
TEST_BINS = $(TESTS:$(TESTDIR)/%.c=$(BUILDDIR)/%)

# Targets
all: $(TEST_BINS)

$(BUILDDIR)/%.o: $(SRCDIR)/%.c
	$(CC) $(CFLAGS) -c $< -o $@

$(BUILDDIR)/%: $(TESTDIR)/%.c $(OBJS)
	$(CC) $(CFLAGS) $< $(OBJS) $(LDFLAGS) -o $@

clean:
	rm -rf $(BUILDDIR)

.PHONY: all clean
